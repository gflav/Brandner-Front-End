!function(t){t(document).ready(function(){n.init()});var n={source:null,template:null,instance:null,instances:[],init:function(){this.setup(),this.listen()},setup:function(){this.templates()},templates:function(){this.source=t("#template-modal").html(),this.template=Handlebars.compile(this.source)},listen:function(){t(document).keyup(function(t){t.keyCode==brandnerdesign.KEYCODE_ESC&&n.close()}),t(document).on("click","li.trigger-modal a,a.trigger-modal,.terms_chkbox",function(e){e.preventDefault();var s=t(this),a=t.md5(s.attr("href"));n.open(a,{url:s.attr("href"),selector:"#site-content",css_class:"modal-instance-simple",footer:'<a href="#" class="trigger-top">Back to top</a>'})}),t(document).on("click",".trigger-modal-close",function(n){n.preventDefault();var e=t(this);e.closest(".modal").modal("hide")}),t(document).on("show.bs.modal",".modal",function(){var n=t(this);setTimeout(function(){n.addClass("animate")},100)}),t(document).on("hide.bs.modal",".modal",function(){var e=t(this);n.close(e)})},addInstance:function(t,n){return this.instances.push({name:t,instance:n}),this},exists:function(t){return this.getInstance(t)!==!1},getInstance:function(n){if(n){var e=t.grep(this.instances,function(t){return t.name===n});return e.length>0&&e.pop()}return this.instance},popInstance:function(n){var e=null;return this.instances=t.grep(this.instances,function(t){return n!==t.name||(e=t.instance,!1)}),e},open:function(e,s){var a=t.Deferred();if(this.exists(e))this.instance=this.getInstance(e).instance,this.instance.modal("show"),a.resolve();else{var i={ajax:!1,data:null,url:null,html:null,selector:null,css_class:"",footer:"",cache:!0},o=t.extend({},i,s);if(t("body").append(this.template({name:e,css_class:o.css_class})),this.instance=t('.modal[data-instance="'+e+'"]'),o.ajax&&t.get(o.url,o.data).done(function(e){e.content.rendered&&(t(".modal-inner",n.instance).html(e.content.rendered),n.instance.modal("show"),a.resolve())}),o.url&&!o.ajax){var c=o.url;o.cache||c.indexOf("?")!==-1&&(c+="&cid="+(new Date).getTime()),o.selector&&(c+=" "+o.selector),t(".modal-inner",this.instance).load(c,function(e){var s=t.parseHTML(e),i=t("#site-content",s);i.length>0&&t(".modal-inner",n.instance).html(i.html()),o.footer&&t(".modal-inner",n.instance).append(o.footer),n.instance.modal("show"),a.resolve()})}o.html&&(t(".modal-inner",this.instance).html(o.html),this.instance.modal("show"),a.resolve()),this.addInstance(e,this.instance)}return a.promise()},close:function(n){var e=null;return e="object"==t.type(n)?{name:n.attr("data-instance"),instance:n,closed:!0}:n&&this.exists(n)?this.getInstance(n):this.getInstance(),e&&(e.closed||e.instance.modal("hide"),e.instance.removeClass("animate").trigger("modal.close",[e.name,e.instance])),this},remove:function(t){if(this.exists(t)){var n=this.popInstance(t);n&&n.remove()}return this}};window.$modal=n}(jQuery);